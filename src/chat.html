<!DOCTYPE html>
<html lang="ru" class="page">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="theme-color" content="#111111">
    <title>Чат</title>
    <link rel="preload" href="fonts/CoFoSans-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="fonts/CoFoSans-Medium.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="stylesheet" href="css/vendor.css">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/chat-page.css">
    <script defer src="js/chat-page.js"></script>
</head>

<body class="page__body">
    <div class="site-container">
        @include('partials/header.html')
        <main class="main chat-page">
            <div class="chat chat-lora container">
                <div class="chat__container">
                    <div class="chat__col">
                        <div class="chat__top chat-lora__top">
                            <div>
                                <div class="chat__avatar avatar">
                                    <img loading="lazy" src="./img/lora_face.png" width="35" height="35" alt="Лора">
                                </div>
                                <h3 class="chat__user">
                                    Лора
                                </h3>
                                <h3 class="chat__pos">
                                    Искусственный интеллект
                                </h3>
                            </div>
                        </div>
                        <div class="chat__wrapper">
                            <div class="chat__bar simplebar-third">
                                <time datetime="2024-01-19" class="chat__date">19 января</time>
                                <div class="message-item chat__message">
                                    <div class="message-item__text">
                                        <p>
                                            Здравствуйте, я Lora, первый цифровой человек в мире девелопмента. Я могу рассказать вам о проектах
                                        </p>
                                        <span>09:45</span>
                                    </div>
                                </div>
                                <div class="message-item chat__message chat__message--me">
                                    <div class="message-item__text">
                                        <p>
                                            Паспорт
                                        </p>
                                        <span>09:45</span>
                                    </div>
                                </div>
                                <div class="message-item chat__message message-item--clue">
                                    <div class="message-item__text">
                                        <span>
                                            Вот что я нашла
                                        </span>
                                        <div>
                                            <button type="button" class="btn btn-reset message-item__btn-clue">
                                                <span>Не подтягиваются данные из личного кабинета</span>
                                                <svg>
                                                    <use xlink:href="./img/sprite.svg#check"></use>
                                                </svg>
                                            </button>
                                            <button type="button" class="btn btn-reset message-item__btn-clue">
                                                <span>Не проходит платёж за паспорт</span>
                                                <svg>
                                                    <use xlink:href="./img/sprite.svg#check"></use>
                                                </svg>
                                            </button>
                                            <button type="button" class="btn btn-reset message-item__btn-clue">
                                                <span>Проблема при отправке заявления на паспорт</span>
                                                <svg>
                                                    <use xlink:href="./img/sprite.svg#check"></use>
                                                </svg>
                                            </button>
                                        </div>
                                        <span>09:45</span>
                                    </div>
                                </div>
                                <time datetime="2024-01-19" class="chat__date">Сегодня</time>
                                <div class="message-item chat__message chat__message--me">
                                    <div class="message-item__text">
                                        <p>
                                            Вопрос
                                        </p>
                                        <span>09:45</span>
                                    </div>
                                </div>
                                <div class="message-item chat__message">
                                    <div class="message-item__text">
                                        <p>
                                            Ответ Лоры
                                        </p>
                                        <span>09:45</span>
                                    </div>
                                </div>
                                <div class="message-item chat__message chat__message--me">
                                    <div class="message-item__text">
                                        <p>
                                            Вопрос
                                        </p>
                                        <span>09:45</span>
                                    </div>
                                </div>
                                <div class="message-item chat__message">
                                    <div class="message-item__text">
                                        <p>
                                            Ответ Лоры
                                        </p>
                                        <span>09:45</span>
                                    </div>
                                    <div class="message-item__text">
                                        <p>
                                            Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры
                                            Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры Ответ Лоры
                                        </p>
                                        <span>09:45</span>
                                    </div>
                                </div>
                                <div class="message-item chat__message message-item--help">
                                    <div class="message-item__text">
                                        <span>
                                            Готова помочь разобраться. Что вас интересует?
                                        </span>
                                        <div>
                                            <button type="button" class="btn btn-reset tag message-item__btn-help">
                                                Продажа
                                            </button>
                                            <button type="button" class="btn btn-reset tag message-item__btn-help">
                                                Аренда
                                            </button>
                                            <button type="button" class="btn btn-reset tag message-item__btn-help">
                                                Подробнее о разделе
                                            </button>
                                            <button type="button" class="btn btn-reset tag message-item__btn-help">
                                                Как оставить заявку на подбор?
                                            </button>
                                            <button type="button" class="btn btn-reset tag message-item__btn-help">
                                                Позови человека
                                            </button>
                                        </div>
                                        <span>09:45</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chat__bottom textarea-secondary" data-textarea-secondary-min-height="50" data-textarea-secondary-max-height="125">
                                <textarea class="input-reset chat__textarea textarea-secondary__input" placeholder="Ваше сообщение" maxlength="1024"></textarea>
                                <button type="button" class="btn btn-reset chat__bottom-send" title="Отправить">
                                    <svg>
                                        <use xlink:href="./img/sprite.svg#send"></use>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="chat__col chat-tags">
                        <h3 class="chat-tags__title title-3">
                            Программа 450
                        </h3>
                        <div class="chat-tags__list">
                            <button type="button" class="btn btn-reset chat-tags__item tag" data-chat-tag>
                                Как подать онлайн-заявление на участие в программе помощи многодетным семьям в погашении ипотеки?
                            </button>
                            <button type="button" class="btn btn-reset chat-tags__item tag" data-chat-tag>
                                Как заполнить данные о заявителе?
                            </button>
                            <button type="button" class="btn btn-reset chat-tags__item tag" data-chat-tag>
                                Как исправить ошибку в личных данных на портале?
                            </button>
                            <button type="button" class="btn btn-reset chat-tags__item tag" data-chat-tag>
                                Как заполнить данные о детях?
                            </button>
                            <button type="button" class="btn btn-reset chat-tags__item tag" data-chat-tag>
                                Как заполнить заявление, если некоторым детям уже исполнилось 14 лет?
                            </button>
                            <button type="button" class="btn btn-reset chat-tags__item tag" data-chat-tag>
                                Как заполнить данные о кредите?
                            </button>
                            <button type="button" class="btn btn-reset chat-tags__item tag" data-chat-tag>
                                Как заполнить заявление, если ипотечная квартира находится в залоге у банка?
                            </button>
                            <button type="button" class="btn btn-reset chat-tags__item tag" data-chat-tag>
                                Как заполнить заявление, если в залоге у банка находится другое имущество?
                            </button>
                            <button type="button" class="btn btn-reset chat-tags__item tag" data-chat-tag>
                                Какие документы необходимо загрузить на портал при подаче онлайн-заявления на выплату?
                            </button>
                            <button type="button" class="btn btn-reset chat-tags__item tag" data-chat-tag>
                                Куда направляется заявление после его оформления на портале Госуслуг?
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- popups -->
    @include('popups/city.html')
    @include('popups/add.html')
    @include('popups/personal-area2.html')
    @include('popups/edit-profile.html')
    @include('popups/sber-tied.html')
    <!-- popups -->

</body>

<script>
    // test script
    const map = {
        textArr: [
            '<p>Первым действием, которое необходимо совершить при оформлении электронного заявления на выплату многодетным семьям на погашение ипотеки, будет выбор заявителя.</p>',
            '<p> <img width="800" alt="Как заполнить данные о заявителе при оформлении выплаты 450 тысяч" src="https://xn--h1alcedd.xn--d1aqf.xn--p1ai/upload/medialibrary/9c8/6b7ljjyicve1ee72l8u80zo5j3mfr0ym/1-inst.png" height="398" title="Как заполнить данные о заявителе при оформлении выплаты 450 тысяч"></p>',
            '<p>Если заявитель является единственным заемщиком по кредитному договору, то ему необходимо выбрать поле «Заемщик». Также этот пункт нужно выбрать, если заявление подает один из созаемщиков по кредиту, например, если ипотека оформлена на супругов. В таком случае после выбора поля «Заемщик», необходимо будет указать того заемщика по кредитному договору, который является родителем (мать или отец) либо усыновителем трех и более детей, один из которых был рожден с 1 января 2019 года по 31 декабря 2023 года.</p>',
            '<p>Если заявителем выступает поручитель по кредитному договору, то необходимо выбрать поле «Поручитель». Важно учитывать, что поручители могут подать заявку на выплату только в случае, если договор поручительства был заключен не позднее 29 апреля 2021 года?. Далее к заявке необходимо будет приложить копию паспорта заемщика по кредитному договору.</p>',
        ],
        messageItemHTML: `
        <div class="message-item chat__message">
            <div class="message-item__text">
            </div>
        </div>
        `,
        stubHTML: `
        <div class="flashing-dots">
            <div class="flashing-dots__dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <p>
                Печатает...
            </p>
        </div>
        `,
    };

    function createBlock(html, where) {
        where.insertAdjacentHTML('beforeend', html);
    }

    function createBlockMe(text, where) {
        const html = `
        <div class="message-item chat__message chat__message--me">
            <div class="message-item__text">
                <p>
                    ${text.trim()}
                </p>
                <span>09:45</span>
            </div>
        </div>
        `;
        where.insertAdjacentHTML('beforeend', html);
    }

    function scrollContent() {
        const chatPage = document.querySelector('.chat-page');
        if (chatPage) {
            const element = chatPage.querySelector('.simplebar-content-wrapper');
            const content = element.querySelector('.simplebar-content');
            const lastMessageMe = element.querySelector('.message-item:nth-last-child(2)');
            const lastMessage = element.querySelector('.message-item:last-child');
            element.scrollTo({
                top: content.scrollHeight
            })
        }
    }

    function deleteStub(section) {
        const stub = section.querySelector('.flashing-dots');
        if (stub) stub.remove();
    }
    document.addEventListener('click', (e) => {
        const target = e.target;
        const tag = target.closest('[data-chat-tag]');

        if (tag) {
            let count = 0;
            const content = document.querySelector('.simplebar-content');
            createBlockMe(tag.textContent, content);
            createBlock(map.messageItemHTML, content);

            const currentBlockText = content.querySelector('.message-item:last-child .message-item__text');
            createBlock(map.stubHTML, currentBlockText)
            scrollContent();

            let interval = setInterval(() => {
                deleteStub(currentBlockText);
                createBlock(map.textArr[count], currentBlockText)
                count++;
                count >= map.textArr.length ? clearInterval(interval) : createBlock(map.stubHTML, currentBlockText)
                scrollContent();
            }, 1500);
        }
    })

</script>

</html>
